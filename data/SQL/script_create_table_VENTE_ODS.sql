--- Création de la table VENTE_ODS.ODS_TYPE_CLIENT
CREATE TABLE ODS_TYPE_CLIENT 
(
CD_TYPE_CLIENT VARCHAR2(50) NOT NULL,
LB_TYPE_CLIENT VARCHAR2(100) NOT NULL,
LB_NOM_FICHIER VARCHAR2(100) NOT NULL,
DT_INSERTION	TIMESTAMP(6) NOT NULL,
BL_LIGNE_ACTIVE NUMBER NOT NULL,
LB_JOB_NAME VARCHAR2(100) NOT NULL
);


--- Création de la table VENTE_ODS.ODS_CLIENT
CREATE TABLE ODS_CLIENT 
(
ID_CLIENT VARCHAR2(50) NOT NULL,
NOM_CLIENT VARCHAR2(100) NOT NULL,
PREN_CLIENT VARCHAR2(100) NOT NULL,
CD_POSTAL_CLIENT VARCHAR2(100),
VILLE_CLIENT VARCHAR2(100) NOT NULL,
PAYS_CLIENT VARCHAR2(100) NOT NULL,
REGION_CLIENT VARCHAR2(100) NOT NULL,
CD_TYPE_CLIENT VARCHAR2(50) NOT NULL,
LB_NOM_FICHIER VARCHAR2(100) NOT NULL,
DT_INSERTION	TIMESTAMP(6) NOT NULL,
BL_LIGNE_ACTIVE NUMBER NOT NULL,
LB_JOB_NAME VARCHAR2(100) NOT NULL
);


--- Création de la table VENTE_ODS.ODS_CATEGORIE
CREATE TABLE ODS_CATEGORIE 
(
CD_CATEGORIE VARCHAR2(50) NOT NULL,
LB_CATEGORIE VARCHAR2(100) NOT NULL,
LB_NOM_FICHIER VARCHAR2(100) NOT NULL,
DT_INSERTION	TIMESTAMP(6) NOT NULL,
BL_LIGNE_ACTIVE NUMBER NOT NULL,
LB_JOB_NAME VARCHAR2(100) NOT NULL
);


--- Création de la table VENTE_ODS.ODS_SOUS_CATEGORIE
CREATE TABLE ODS_SOUS_CATEGORIE 
(
CD_SOUS_CATEGORIE VARCHAR2(50) NOT NULL,
LB_SOUS_CATEGORIE VARCHAR2(100) NOT NULL,
CD_CATEGORIE VARCHAR2(100) NOT NULL,
LB_NOM_FICHIER VARCHAR2(100) NOT NULL,
DT_INSERTION	TIMESTAMP(6) NOT NULL,
BL_LIGNE_ACTIVE NUMBER NOT NULL,
LB_JOB_NAME VARCHAR2(100) NOT NULL
);


--- Création de la table VENTE_ODS.ODS_PRODUIT
CREATE TABLE ODS_PRODUIT 
(
CD_PRODUIT VARCHAR2(50) NOT NULL,
NOM_PRODUIT VARCHAR2(200) NOT NULL,
PRIX_ACHAT_PRODUIT NUMBER NOT NULL,
PRIX_VENTE_PRODUIT NUMBER NOT NULL,
CD_SOUS_CATEGORIE VARCHAR2(50) NOT NULL,
LB_NOM_FICHIER VARCHAR2(100) NOT NULL,
DT_INSERTION	TIMESTAMP NOT NULL,
BL_LIGNE_ACTIVE NUMBER NOT NULL,
LB_JOB_NAME VARCHAR2(100) NOT NULL
);


--- Création de la table VENTE_ODS.ODS_VENTE
CREATE TABLE ODS_VENTE 
(
ID_VENTE 		 	VARCHAR2(50)  NOT NULL,
CD_PRODUIT 	 	VARCHAR2(50)  NOT NULL,	
DT_VENTE 			DATE    NOT NULL,
ID_CLIENT 	 	VARCHAR2(50)  NOT NULL,
QTE_VENTE 	 	NUMBER      NOT NULL,
PRIX_ACHAT 	 	NUMBER      NOT NULL,
PRIX_VENTE 	 	NUMBER      NOT NULL,
LB_NOM_FICHIER 	VARCHAR2(100) NOT NULL,	
DT_INSERTION    	TIMESTAMP(6)    NOT NULL,
LB_JOB_NAME	  	VARCHAR2(100) NOT NULL
);


-- création de la table rejet
CREATE TABLE ODS_REJET
(
NUM_LIGNE_REJET NUMBER NOT NULL,
LB_NOM_FICHIER VARCHAR2(100) NOT NULL,
LB_LIGNE_REJET VARCHAR2(500) NOT NULL,
LB_MESSAGE_REJET VARCHAR2(400) NOT NULL,
LB_NOM_FLUX VARCHAR2(100) NOT NULL,
DT_REJET TIMESTAMP(6) NOT NULL);


/*
-- creation des clés primaires et étrangères
ALTER TABLE ODS_TYPE_CLIENT
ADD CONSTRAINTS pk_ODS_TYPE_CLIENT PRIMARY KEY(cd_type_client);

ALTER TABLE ODS_CLIENT
ADD CONSTRAINTS pk_ODS_CLIENT PRIMARY KEY(id_client)
ADD CONSTRAINTS fk_ODS_TYPE_CLIENT FOREIGN KEY(cd_type_client) REFERENCES ODS_TYPE_CLIENT(cd_type_client);

ALTER TABLE ODS_CATEGORIE
ADD CONSTRAINTS pk_ODS_CATEGORIE PRIMARY KEY(cd_categorie);

ALTER TABLE ODS_SOUS_CATEGORIE
ADD CONSTRAINTS pk_ODS_SOUS_CATEGORIE PRIMARY KEY(cd_sous_categorie)
ADD CONSTRAINTS fk_ODS_CATEGORIE FOREIGN KEY(cd_categorie) REFERENCES ODS_CATEGORIE(cd_categorie);

ALTER TABLE ODS_PRODUIT
ADD CONSTRAINTS pk_ODS_PRODUIT PRIMARY KEY(cd_produit)
ADD CONSTRAINTS fk_ODS_SOUS_CATEGORIE FOREIGN KEY(cd_sous_categorie) REFERENCES ODS_SOUS_CATEGORIE(cd_sous_categorie);

ALTER TABLE ODS_VENTE
ADD CONSTRAINTS pk_ODS_VENTE PRIMARY KEY(id_vente)
ADD CONSTRAINTS fk_ODS_PRODUIT FOREIGN KEY(cd_produit) REFERENCES ODS_PRODUIT(cd_produit)
ADD CONSTRAINTS fk_ODS_CLIENT FOREIGN KEY(id_client) REFERENCES ODS_CLIENT(id_client);
*/


-- BOUCLE PL/SQL QUI SUPPRIME TOUTES LES TABLES DE LA BDD
BEGIN
FOR rec IN (
    SELECT table_name
    FROM all_tables
    WHERE owner='C##RAPHAEL' 
    ORDER BY table_name DESC)
LOOP
    EXECUTE IMMEDIATE 'DROP TABLE '||rec.table_name||' CASCADE CONSTRAINTS';
END LOOP;
END;
/
